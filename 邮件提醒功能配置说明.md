# é‚®ä»¶æé†’åŠŸèƒ½é…ç½®è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æ—¶é—´èƒ¶å›Šç³»ç»Ÿæ”¯æŒåœ¨èƒ¶å›Šå¼€å¯æ—¥æœŸåˆ°è¾¾æ—¶å‘é€ QQ é‚®ä»¶æé†’ç”¨æˆ·ï¼Œç¡®ä¿ä¸é”™è¿‡ä»»ä½•é‡è¦å›å¿†çš„å¼€å¯æ—¶åˆ»ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… è‡ªåŠ¨æ£€æŸ¥å³å°†å¼€å¯çš„èƒ¶å›Š
- âœ… æå‰ 7 å¤©å¼€å§‹æé†’
- âœ… ç¾è§‚çš„ HTML é‚®ä»¶æ¨¡æ¿
- âœ… æ”¯æŒ QQ é‚®ç®±
- âœ… è®°å½•é‚®ä»¶å‘é€çŠ¶æ€ï¼Œé¿å…é‡å¤å‘é€
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… æ¯å¤©è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡

---

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½® QQ é‚®ç®±

ç¼–è¾‘ `backend/email_config.py` æ–‡ä»¶ï¼š

```python
# QQé‚®ç®±SMTPé…ç½®
SMTP_SERVER = "smtp.qq.com"
SMTP_PORT = 465  # SSLç«¯å£
SMTP_USE_SSL = True

# å‘ä»¶äººé‚®ç®±ï¼ˆæ›¿æ¢ä¸ºä½ çš„QQé‚®ç®±ï¼‰
SENDER_EMAIL = "your_qq@qq.com"

# å‘ä»¶äººæˆæƒç ï¼ˆéœ€è¦åˆ°QQé‚®ç®±è®¾ç½®ä¸­ç”Ÿæˆï¼‰
SENDER_PASSWORD = "your_authorization_code"

# å‘ä»¶äººæ˜¾ç¤ºåç§°
SENDER_NAME = "æ—¶é—´èƒ¶å›Š"
```

### 2. è·å– QQ é‚®ç®±æˆæƒç 

#### æ­¥éª¤è¯¦è§£

1. **ç™»å½• QQ é‚®ç®±**
   - è®¿é—® https://mail.qq.com
   - ä½¿ç”¨ä½ çš„ QQ å·ç ç™»å½•é‚®ç®±

2. **è¿›å…¥è®¾ç½®é¡µé¢**
   - ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„"è®¾ç½®"æŒ‰é’®
   - é€‰æ‹©"è´¦æˆ·"é€‰é¡¹å¡

3. **å¼€å¯ SMTP æœåŠ¡**
   - æ‰¾åˆ°"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAVæœåŠ¡"éƒ¨åˆ†
   - ç‚¹å‡»"å¼€å¯"æˆ–"ç”Ÿæˆæˆæƒç "æŒ‰é’®

4. **éªŒè¯èº«ä»½**
   - æŒ‰ç…§æç¤ºå‘é€çŸ­ä¿¡éªŒè¯
   - çŸ­ä¿¡æ ¼å¼é€šå¸¸ä¸ºï¼š`é…ç½®é‚®ä»¶å®¢æˆ·ç«¯` å‘é€åˆ°æŒ‡å®šçš„å·ç 

5. **è·å–æˆæƒç **
   - éªŒè¯æˆåŠŸåä¼šæ˜¾ç¤ºæˆæƒç 
   - **é‡è¦**ï¼šæˆæƒç åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹å³å¤åˆ¶ä¿å­˜
   - æˆæƒç æ˜¯ä¸€ä¸ª 16 ä½çš„å­—ç¬¦ä¸²

6. **é…ç½®åˆ°é¡¹ç›®**
   - å°†è·å–çš„æˆæƒç ç²˜è´´åˆ° `backend/email_config.py` çš„ `SENDER_PASSWORD` å­—æ®µ
   - å°†ä½ çš„ QQ é‚®ç®±åœ°å€å¡«å†™åˆ° `SENDER_EMAIL` å­—æ®µ

### 3. æµ‹è¯•é‚®ä»¶å‘é€

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

```bash
cd backend
python test_email.py
```

**ä¿®æ”¹æµ‹è¯•é‚®ç®±**ï¼š

ç¼–è¾‘ `backend/test_email.py`ï¼Œä¿®æ”¹æµ‹è¯•æ”¶ä»¶äººï¼š

```python
# æµ‹è¯•é‚®ç®±åœ°å€
TEST_EMAIL = "your_test@qq.com"
```

è¿è¡Œåï¼Œå¦‚æœé…ç½®æ­£ç¡®ï¼Œä½ åº”è¯¥ä¼šæ”¶åˆ°ä¸€å°æµ‹è¯•é‚®ä»¶ã€‚

### 4. è®¾ç½®å®šæ—¶ä»»åŠ¡

#### Linux/macOS (ä½¿ç”¨ cron)

1. **ç¼–è¾‘ crontab**

```bash
crontab -e
```

2. **æ·»åŠ å®šæ—¶ä»»åŠ¡**

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ¯å¤©æ—©ä¸Š 9 ç‚¹æ£€æŸ¥å¹¶å‘é€æé†’ï¼‰ï¼š

```bash
0 9 * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1
```

**è¯´æ˜**ï¼š
- `0 9 * * *` - æ¯å¤© 9:00 æ‰§è¡Œ
- `cd /mnt/d/python/item/new/backend` - åˆ‡æ¢åˆ°åç«¯ç›®å½•
- `python3 check_reminders.py` - æ‰§è¡Œæ£€æŸ¥è„šæœ¬
- `>> /mnt/d/python/item/new/backend/reminders.log` - è¾“å‡ºé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶
- `2>&1` - é”™è¯¯è¾“å‡ºä¹Ÿé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶

**å…¶ä»–å¸¸ç”¨æ—¶é—´è®¾ç½®**ï¼š

```bash
# æ¯å¤©æ—©ä¸Š 8 ç‚¹
0 8 * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1

# æ¯å¤©ä¸­åˆ 12 ç‚¹
0 12 * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1

# æ¯å¤©æ™šä¸Š 8 ç‚¹
0 20 * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
0 * * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1
```

3. **ä¿å­˜å¹¶é€€å‡º**

- å¦‚æœä½¿ç”¨ vimï¼šæŒ‰ `Esc`ï¼Œè¾“å…¥ `:wq`ï¼ŒæŒ‰ `Enter`
- å¦‚æœä½¿ç”¨ nanoï¼šæŒ‰ `Ctrl+O` ä¿å­˜ï¼ŒæŒ‰ `Ctrl+X` é€€å‡º

4. **éªŒè¯ crontab**

```bash
crontab -l
```

åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰æ·»åŠ çš„å®šæ—¶ä»»åŠ¡ã€‚

5. **æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¥å¿—**

```bash
tail -f /mnt/d/python/item/new/backend/reminders.log
```

#### Windows (ä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åº)

1. **æ‰“å¼€ä»»åŠ¡è®¡åˆ’ç¨‹åº**

   - æŒ‰ `Win + R`ï¼Œè¾“å…¥ `taskschd.msc`ï¼ŒæŒ‰ `Enter`
   - æˆ–é€šè¿‡æ§åˆ¶é¢æ¿æ‰¾åˆ°ä»»åŠ¡è®¡åˆ’ç¨‹åº

2. **åˆ›å»ºåŸºæœ¬ä»»åŠ¡**

   - åœ¨å³ä¾§ç‚¹å‡»"åˆ›å»ºåŸºæœ¬ä»»åŠ¡"
   - è¾“å…¥ä»»åŠ¡åç§°ï¼Œä¾‹å¦‚ï¼š"æ—¶é—´èƒ¶å›Šé‚®ä»¶æé†’"
   - ç‚¹å‡»"ä¸‹ä¸€æ­¥"

3. **è®¾ç½®è§¦å‘å™¨**

   - é€‰æ‹©"æ¯å¤©"
   - ç‚¹å‡»"ä¸‹ä¸€æ­¥"
   - è®¾ç½®å¼€å§‹æ—¶é—´ï¼ˆä¾‹å¦‚ï¼š09:00:00ï¼‰
   - é‡å¤é—´éš”é€‰æ‹©"1"å¤©
   - ç‚¹å‡»"ä¸‹ä¸€æ­¥"

4. **è®¾ç½®æ“ä½œ**

   - é€‰æ‹©"å¯åŠ¨ç¨‹åº"
   - ç‚¹å‡»"ä¸‹ä¸€æ­¥"
   - é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

   **ç¨‹åºæˆ–è„šæœ¬**ï¼š
   ```
   python3
   ```

   **æ·»åŠ å‚æ•°**ï¼š
   ```
   check_reminders.py
   ```

   **èµ·å§‹äº**ï¼š
   ```
   D:\python\item\new\backend
   ```
   ï¼ˆæ ¹æ®ä½ çš„å®é™…è·¯å¾„ä¿®æ”¹ï¼‰

5. **å®Œæˆè®¾ç½®**

   - ç‚¹å‡»"ä¸‹ä¸€æ­¥"
   - å‹¾é€‰"å½“å•å‡»å®Œæˆæ—¶ï¼Œæ‰“å¼€æ­¤ä»»åŠ¡å±æ€§çš„å¯¹è¯æ¡†"
   - ç‚¹å‡»"å®Œæˆ"

6. **é…ç½®é«˜çº§é€‰é¡¹**

   åœ¨æ‰“å¼€çš„ä»»åŠ¡å±æ€§å¯¹è¯æ¡†ä¸­ï¼š

   - åˆ‡æ¢åˆ°"æ¡ä»¶"é€‰é¡¹å¡
   - å–æ¶ˆå‹¾é€‰"åªæœ‰åœ¨è®¡ç®—æœºä½¿ç”¨äº¤æµç”µæºæ—¶æ‰å¯åŠ¨æ­¤ä»»åŠ¡"
   - å–æ¶ˆå‹¾é€‰"å¦‚æœè®¡ç®—æœºä½¿ç”¨ç”µæ± ï¼Œåˆ™ä»…åœ¨ä½¿ç”¨äº¤æµç”µæºæ—¶å¯åŠ¨"

   - åˆ‡æ¢åˆ°"è®¾ç½®"é€‰é¡¹å¡
   - å‹¾é€‰"å¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŒ‰ä»¥ä¸‹é¢‘ç‡é‡æ–°å¯åŠ¨"
   - è®¾ç½®é‡æ–°å¯åŠ¨é—´éš”ä¸º 5 åˆ†é’Ÿï¼Œé‡è¯•æ¬¡æ•°ä¸º 3 æ¬¡
   - ç‚¹å‡»"ç¡®å®š"

7. **æµ‹è¯•ä»»åŠ¡**

   - åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­æ‰¾åˆ°åˆ›å»ºçš„ä»»åŠ¡
   - å³é”®ç‚¹å‡»ï¼Œé€‰æ‹©"è¿è¡Œ"
   - æ£€æŸ¥æ˜¯å¦æ­£å¸¸æ‰§è¡Œ

#### æ‰‹åŠ¨è¿è¡Œ

ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š

```bash
cd backend
python3 check_reminders.py
```

---

## å·¥ä½œåŸç†

### æ•°æ®åº“å­—æ®µ

`capsules` è¡¨ä¸­çš„ `email_sent` å­—æ®µç”¨äºè®°å½•æ˜¯å¦å·²å‘é€æé†’é‚®ä»¶ï¼š

- `0` - æœªå‘é€
- `1` - å·²å‘é€

### æ£€æŸ¥é€»è¾‘

`check_reminders.py` è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **è·å–å½“å‰æ—¶é—´**
   - è·å–ç³»ç»Ÿå½“å‰æ—¥æœŸå’Œæ—¶é—´

2. **è®¡ç®—æ—¶é—´èŒƒå›´**
   - æ£€æŸ¥ä»ä»Šå¤©åˆ°æœªæ¥ 7 å¤©å†…çš„èƒ¶å›Š
   - ä¾‹å¦‚ï¼šä»Šå¤©æ˜¯ 2026-01-30ï¼Œåˆ™æ£€æŸ¥ 2026-01-30 åˆ° 2026-02-06 çš„èƒ¶å›Š

3. **æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„èƒ¶å›Š**
   ```sql
   SELECT c.id, c.title, c.open_date, c.email_sent, u.username, u.email
   FROM capsules c
   JOIN users u ON c.user_id = u.id
   WHERE c.is_opened = 0
     AND c.email_sent = 0
     AND c.open_date BETWEEN ? AND ?
   ORDER BY c.open_date ASC
   ```

4. **é€ä¸ªå‘é€é‚®ä»¶**
   - éå†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èƒ¶å›Š
   - ä¸ºæ¯ä¸ªèƒ¶å›Šå‘é€ä¸€å°æé†’é‚®ä»¶
   - é‚®ä»¶å‘é€æˆåŠŸåï¼Œå°† `email_sent` è®¾ç½®ä¸º 1

5. **è®°å½•æ—¥å¿—**
   - è®°å½•æ£€æŸ¥å¼€å§‹æ—¶é—´
   - è®°å½•æ‰¾åˆ°çš„èƒ¶å›Šæ•°é‡
   - è®°å½•æ¯ä¸ªèƒ¶å›Šçš„å¤„ç†ç»“æœ
   - è®°å½•æˆåŠŸå’Œå¤±è´¥çš„é‚®ä»¶æ•°é‡

### é‚®ä»¶å†…å®¹

é‚®ä»¶ä½¿ç”¨ HTML æ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

- **æ”¶ä»¶äºº**ï¼šåˆ›å»ºèƒ¶å›Šçš„ç”¨æˆ·
- **ä¸»é¢˜**ï¼š"ã€æ—¶é—´èƒ¶å›Šæé†’ã€‘æ‚¨çš„èƒ¶å›Šå³å°†å¼€å¯"
- **å†…å®¹**ï¼š
  - é—®å€™è¯­
  - èƒ¶å›Šæ ‡é¢˜
  - å¼€å¯æ—¥æœŸ
  - è·ç¦»å¼€å¯è¿˜æœ‰å¤šå°‘å¤©
  - æé†’ç”¨æˆ·åŠæ—¶æŸ¥çœ‹
  - åº”ç”¨é“¾æ¥

### é‚®ä»¶æ¨¡æ¿ç¤ºä¾‹

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background-color: #667eea; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; background-color: #f9f9f9; }
        .capsule-info { background-color: white; padding: 15px; margin: 10px 0; border-left: 4px solid #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“§ æ—¶é—´èƒ¶å›Šæé†’</h1>
        </div>
        <div class="content">
            <p>äº²çˆ±çš„ <strong>{username}</strong>ï¼Œ</p>
            <p>æ‚¨åˆ›å»ºçš„æ—¶é—´èƒ¶å›Šå³å°†å¼€å¯ï¼</p>
            <div class="capsule-info">
                <h3>{title}</h3>
                <p><strong>å¼€å¯æ—¥æœŸï¼š</strong>{open_date}</p>
                <p><strong>è·ç¦»å¼€å¯è¿˜æœ‰ï¼š</strong>{days_left} å¤©</p>
            </div>
            <p>è¯·åŠæ—¶ç™»å½•æ—¶é—´èƒ¶å›Šåº”ç”¨ï¼ŒæŸ¥çœ‹æ‚¨çš„çè´µå›å¿†ã€‚</p>
            <p>ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼</p>
            <p>â€”â€” æ—¶é—´èƒ¶å›Šå›¢é˜Ÿ</p>
        </div>
    </div>
</body>
</html>
```

---

## æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

1. **ä¸è¦æäº¤æˆæƒç åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ**
   - æˆæƒç æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸åº”å‡ºç°åœ¨ Git ä»“åº“ä¸­
   - å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æˆæƒç 
   - å°† `email_config.py` æ·»åŠ åˆ° `.gitignore`

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

   ä¿®æ”¹ `email_config.py`ï¼š

   ```python
   import os

   # QQé‚®ç®±SMTPé…ç½®
   SMTP_SERVER = "smtp.qq.com"
   SMTP_PORT = 465
   SMTP_USE_SSL = True

   # ä»ç¯å¢ƒå˜é‡è¯»å–
   SENDER_EMAIL = os.getenv("SENDER_EMAIL", "")
   SENDER_PASSWORD = os.getenv("SENDER_PASSWORD", "")
   SENDER_NAME = "æ—¶é—´èƒ¶å›Š"
   ```

   è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

   ```bash
   # Linux/macOS
   export SENDER_EMAIL="your_qq@qq.com"
   export SENDER_PASSWORD="your_authorization_code"

   # Windows (PowerShell)
   $env:SENDER_EMAIL="your_qq@qq.com"
   $env:SENDER_PASSWORD="your_authorization_code"

   # Windows (CMD)
   set SENDER_EMAIL=your_qq@qq.com
   set SENDER_PASSWORD=your_authorization_code
   ```

### é¢‘ç‡é™åˆ¶

1. **QQ é‚®ç®±å‘é€é¢‘ç‡é™åˆ¶**
   - QQ é‚®ç®±å¯¹å‘é€é¢‘ç‡æœ‰é™åˆ¶
   - å»ºè®®æ¯å¤©æœ€å¤šå‘é€ 50 å°é‚®ä»¶
   - å¦‚æœç”¨æˆ·æ•°é‡è¾ƒå¤šï¼Œå»ºè®®åˆ†æ•£å‘é€æ—¶é—´

2. **é¿å…åƒåœ¾é‚®ä»¶**
   - ä¸è¦è¿‡äºé¢‘ç¹åœ°å‘é€é‚®ä»¶
   - ç¡®ä¿é‚®ä»¶å†…å®¹æœ‰ä»·å€¼
   - æä¾›å–æ¶ˆè®¢é˜…é€‰é¡¹ï¼ˆå¯é€‰ï¼‰

### ç½‘ç»œè¿æ¥

1. **ç¡®ä¿ç½‘ç»œç¨³å®š**
   - æœåŠ¡å™¨éœ€è¦æœ‰ç¨³å®šçš„ç½‘ç»œè¿æ¥
   - SMTP æœåŠ¡å™¨å¯èƒ½éœ€è¦è®¿é—®å¤–ç½‘

2. **é˜²ç«å¢™è®¾ç½®**
   - ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—® SMTP ç«¯å£ï¼ˆ465ï¼‰
   - æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

### æ—¥å¿—ç®¡ç†

1. **å®šæœŸæ¸…ç†æ—¥å¿—**
   - æ—¥å¿—æ–‡ä»¶ä¼šä¸æ–­å¢é•¿
   - å»ºè®®å®šæœŸæ¸…ç†æˆ–å½’æ¡£æ—¥å¿—

2. **æ—¥å¿—è½®è½¬**

   ä½¿ç”¨ logrotate è‡ªåŠ¨ç®¡ç†æ—¥å¿—ï¼š

   ```bash
   # åˆ›å»ºé…ç½®æ–‡ä»¶ /etc/logrotate.d/time-capsule
   /mnt/d/python/item/new/backend/reminders.log {
       daily
       rotate 7
       compress
       delaycompress
       missingok
       notifempty
       create 644 root root
   }
   ```

---

## æ•…éšœæ’é™¤

### é‚®ä»¶å‘é€å¤±è´¥

#### é—®é¢˜ 1ï¼šæˆæƒç é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Error: 535 Error: authentication failed
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ä½¿ç”¨çš„æ˜¯æˆæƒç ï¼Œä¸æ˜¯ QQ å¯†ç 
2. é‡æ–°ç”Ÿæˆæˆæƒç 
3. æ£€æŸ¥æˆæƒç æ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆæ— å¤šä½™ç©ºæ ¼ï¼‰

#### é—®é¢˜ 2ï¼šSMTP æœåŠ¡æœªå¼€å¯

**ç—‡çŠ¶**ï¼š
```
Error: Connection refused
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç™»å½• QQ é‚®ç®±
2. è¿›å…¥è®¾ç½® â†’ è´¦æˆ·
3. ç¡®è®¤ SMTP æœåŠ¡å·²å¼€å¯
4. é‡æ–°ç”Ÿæˆæˆæƒç 

#### é—®é¢˜ 3ï¼šç½‘ç»œè¿æ¥é—®é¢˜

**ç—‡çŠ¶**ï¼š
```
Error: TimeoutError
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯• ping smtp.qq.com
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. ç¡®è®¤ SMTP ç«¯å£ 465 å¯è®¿é—®

#### é—®é¢˜ 4ï¼šé‚®ç®±åœ°å€é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Error: 550 Invalid recipient
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ”¶ä»¶äººé‚®ç®±åœ°å€æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤é‚®ç®±åœ°å€æ ¼å¼æ­£ç¡®
3. æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²æ³¨é”€

### å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œ

#### é—®é¢˜ 1ï¼šcron æœåŠ¡æœªè¿è¡Œ

**ç—‡çŠ¶**ï¼š
å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼Œæ—¥å¿—æ–‡ä»¶æ²¡æœ‰æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ cron æœåŠ¡çŠ¶æ€
sudo service cron status

# å¯åŠ¨ cron æœåŠ¡
sudo service cron start

# é‡å¯ cron æœåŠ¡
sudo service cron restart
```

#### é—®é¢˜ 2ï¼šcrontab é…ç½®é”™è¯¯

**ç—‡çŠ¶**ï¼š
å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹ crontab é…ç½®
crontab -l

# æ£€æŸ¥è¯­æ³•æ˜¯å¦æ­£ç¡®
# ç¡®ä¿è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„
# ç¡®ä¿å‘½ä»¤æ ¼å¼æ­£ç¡®
```

#### é—®é¢˜ 3ï¼šPython è„šæœ¬è·¯å¾„é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
python3: can't open file 'check_reminders.py': [Errno 2] No such file or directory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤è„šæœ¬è·¯å¾„æ­£ç¡®
2. ä½¿ç”¨ç»å¯¹è·¯å¾„
3. ç¡®è®¤åœ¨ cron å‘½ä»¤ä¸­å…ˆ `cd` åˆ°æ­£ç¡®ç›®å½•

#### é—®é¢˜ 4ï¼šæƒé™é—®é¢˜

**ç—‡çŠ¶**ï¼š
```
Permission denied
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /mnt/d/python/item/new/backend/check_reminders.py

# ç¡®ä¿ç”¨æˆ·æœ‰æ‰§è¡Œæƒé™
# æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…
ls -l /mnt/d/python/item/new/backend/check_reminders.py
```

### é‚®ä»¶é‡å¤å‘é€

#### é—®é¢˜ 1ï¼šemail_sent å­—æ®µæœªæ›´æ–°

**ç—‡çŠ¶**ï¼š
åŒä¸€èƒ¶å›Šæ”¶åˆ°å¤šå°æé†’é‚®ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. æ£€æŸ¥ UPDATE è¯­å¥æ˜¯å¦æ‰§è¡Œ
3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ›´æ–°æ“ä½œ

#### é—®é¢˜ 2ï¼šå®šæ—¶ä»»åŠ¡é‡å¤é…ç½®

**ç—‡çŠ¶**ï¼š
æ”¶åˆ°å¤šå°ç›¸åŒé‚®ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰å®šæ—¶ä»»åŠ¡
crontab -l

# åˆ é™¤é‡å¤çš„ä»»åŠ¡
crontab -e
```

### æŸ¥çœ‹æ—¥å¿—

#### æŸ¥çœ‹ reminders.log

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f /mnt/d/python/item/new/backend/reminders.log

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
tail -n 100 /mnt/d/python/item/new/backend/reminders.log

# æœç´¢é”™è¯¯ä¿¡æ¯
grep "Error" /mnt/d/python/item/new/backend/reminders.log

# æœç´¢æˆåŠŸä¿¡æ¯
grep "æˆåŠŸ" /mnt/d/python/item/new/backend/reminders.log
```

#### æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

```bash
# Linux
tail -f /var/log/syslog

# æŸ¥çœ‹ç›¸å…³æ—¥å¿—
grep "cron" /var/log/syslog
```

---

## é«˜çº§é…ç½®

### ä¿®æ”¹æé†’æ—¶é—´èŒƒå›´

ç¼–è¾‘ `backend/check_reminders.py`ï¼š

```python
# ä¿®æ”¹æé†’å¤©æ•°
future_7days = today + timedelta(days=14)  # æ”¹ä¸º 14 å¤©
```

### ä¿®æ”¹é‚®ä»¶æ¨¡æ¿

ç¼–è¾‘ `backend/email_sender.py` ä¸­çš„ HTML æ¨¡æ¿ï¼š

```python
def create_reminder_email(username, title, open_date, days_left):
    # è‡ªå®šä¹‰é‚®ä»¶å†…å®¹
    html_content = f"""
    <!-- ä½ çš„è‡ªå®šä¹‰æ¨¡æ¿ -->
    """
    return html_content
```

### æ·»åŠ å¤šä¸ªå‘ä»¶äºº

å¦‚æœéœ€è¦æ”¯æŒå¤šä¸ªå‘ä»¶äººé‚®ç®±ï¼š

```python
# email_config.py
EMAILS = [
    {
        "email": "email1@qq.com",
        "password": "password1"
    },
    {
        "email": "email2@qq.com",
        "password": "password2"
    }
]
```

### æ·»åŠ é‚®ä»¶é˜Ÿåˆ—

å¯¹äºå¤§é‡ç”¨æˆ·ï¼Œå¯ä»¥å®ç°é‚®ä»¶é˜Ÿåˆ—ï¼š

```python
# queue.py
import queue
import threading

email_queue = queue.Queue()

def worker():
    while True:
        task = email_queue.get()
        # å‘é€é‚®ä»¶
        email_queue.task_done()

# å¯åŠ¨å·¥ä½œçº¿ç¨‹
threading.Thread(target=worker, daemon=True).start()
```

---

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•

ä¸ºé‚®ä»¶å‘é€åŠŸèƒ½ç¼–å†™å•å…ƒæµ‹è¯•ï¼š

```python
# test_email_sender.py
import unittest
import email_sender

class TestEmailSender(unittest.TestCase):
    def test_create_email_content(self):
        content = email_sender.create_reminder_email(
            "testuser",
            "æµ‹è¯•èƒ¶å›Š",
            "2026-02-01",
            5
        )
        self.assertIn("æµ‹è¯•èƒ¶å›Š", content)
        self.assertIn("2026-02-01", content)

if __name__ == "__main__":
    unittest.main()
```

### é›†æˆæµ‹è¯•

æµ‹è¯•å®Œæ•´çš„é‚®ä»¶å‘é€æµç¨‹ï¼š

```python
# test_integration.py
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

import check_reminders

def test_check_and_send():
    sent, failed = check_reminders.check_and_send_reminders()
    print(f"æˆåŠŸ: {sent}, å¤±è´¥: {failed}")

if __name__ == "__main__":
    test_check_and_send()
```

---

## ç›¸å…³æ–‡ä»¶è¯´æ˜

### email_config.py

é‚®ä»¶é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- SMTP æœåŠ¡å™¨é…ç½®
- å‘ä»¶äººé‚®ç®±
- æˆæƒç 
- å‘ä»¶äººåç§°

### email_sender.py

é‚®ä»¶å‘é€æ¨¡å—ï¼ŒåŒ…å«ï¼š
- `send_reminder_email()` - å‘é€æé†’é‚®ä»¶
- `create_reminder_email()` - åˆ›å»ºé‚®ä»¶å†…å®¹
- SMTP è¿æ¥å’Œå‘é€é€»è¾‘

### check_reminders.py

å®šæ—¶æ£€æŸ¥è„šæœ¬ï¼ŒåŒ…å«ï¼š
- `check_and_send_reminders()` - ä¸»æ£€æŸ¥å‡½æ•°
- æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
- é‚®ä»¶å‘é€è°ƒç”¨
- æ—¥å¿—è®°å½•

### test_email.py

é‚®ä»¶æµ‹è¯•è„šæœ¬ï¼Œç”¨äºï¼š
- æµ‹è¯•é‚®ä»¶é…ç½®
- å‘é€æµ‹è¯•é‚®ä»¶
- éªŒè¯ SMTP è¿æ¥

---

## é™„å½•

### QQ é‚®ç®± SMTP å‚æ•°

| å‚æ•° | å€¼ |
|------|-----|
| æœåŠ¡å™¨åœ°å€ | smtp.qq.com |
| ç«¯å£ï¼ˆSSLï¼‰ | 465 |
| ç«¯å£ï¼ˆTLSï¼‰ | 587 |
| è®¤è¯æ–¹å¼ | LOGIN |
| åŠ å¯†æ–¹å¼ | SSL/TLS |

### å¸¸è§ SMTP é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 220 | æœåŠ¡å°±ç»ª |
| 235 | è®¤è¯æˆåŠŸ |
| 250 | è¯·æ±‚æ“ä½œå®Œæˆ |
| 334 | æœåŠ¡å™¨å“åº”éªŒè¯ Base64 |
| 450 | è¯·æ±‚çš„é‚®ä»¶æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨ |
| 451 | è¯·æ±‚ä¸­æ­¢ï¼Œå¤„ç†æ—¶å‡ºé”™ |
| 452 | ç³»ç»Ÿå­˜å‚¨ä¸è¶³ï¼Œè¯·æ±‚æ“ä½œæœªæ‰§è¡Œ |
| 500 | é‚®ä»¶ç³»ç»Ÿè¯­æ³•é”™è¯¯ |
| 501 | å‚æ•°è¯­æ³•é”™è¯¯ |
| 502 | å‘½ä»¤æœªå®ç° |
| 503 | é”™è¯¯çš„å‘½ä»¤åºåˆ— |
| 504 | å‘½ä»¤å‚æ•°æœªå®ç° |
| 535 | è®¤è¯å¤±è´¥ |
| 550 | è¯·æ±‚çš„é‚®ä»¶æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨ |
| 551 | ç”¨æˆ·éæœ¬åœ°ï¼Œè¯·è½¬å‘ |
| 552 | è¿‡é‡çš„å­˜å‚¨åˆ†é…ï¼Œè¯·æ±‚æ“ä½œæœªæ‰§è¡Œ |
| 553 | é‚®ç®±åä¸å¯ç”¨ |
| 554 | ä¼ è¾“å¤±è´¥ |

### æœ‰ç”¨çš„å‘½ä»¤

```bash
# æµ‹è¯• SMTP è¿æ¥
telnet smtp.qq.com 465

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
nc -zv smtp.qq.com 465

# æŸ¥çœ‹ cron æ—¥å¿—
grep CRON /var/log/syslog

# é‡å¯ cron æœåŠ¡
sudo service cron restart

# æŸ¥çœ‹ Python ç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ Python æ¨¡å—
python3 -c "import smtplib; print('smtplib available')"
```

---

<div align="center">

**æœ€åæ›´æ–°ï¼š2026-01-30**

**é€‚ç”¨ç‰ˆæœ¬ï¼šv1.4.0**

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issueï¼šhttps://github.com/lxx00730/MemoryCapsule/issues

</div>