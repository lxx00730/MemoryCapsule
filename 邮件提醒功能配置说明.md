# 邮件提醒功能配置说明

## 功能概述

时间胶囊系统支持在胶囊开启日期到达时发送QQ邮箱提醒用户。

## 配置步骤

### 1. 配置QQ邮箱SMTP

编辑 `backend/email_config.py` 文件：

```python
# QQ邮箱SMTP配置
SMTP_SERVER = "smtp.qq.com"
SMTP_PORT = 465  # SSL端口
SMTP_USE_SSL = True

# 发件人邮箱（替换为你的QQ邮箱）
SENDER_EMAIL = "your_qq@qq.com"

# 发件人授权码（需要到QQ邮箱设置中生成）
SENDER_PASSWORD = "your_authorization_code"

# 发件人显示名称
SENDER_NAME = "时间胶囊"
```

### 2. 获取QQ邮箱授权码

1. 登录QQ邮箱网页版
2. 点击顶部的"设置" → "账户"
3. 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
4. 点击"生成授权码"
5. 按照提示发送短信获取授权码
6. 将授权码复制到 `email_config.py` 的 `SENDER_PASSWORD` 字段

### 3. 测试邮件发送

运行测试脚本：

```bash
cd backend
python email_sender.py
```

修改 `email_sender.py` 中的测试邮箱地址为你的QQ邮箱，然后运行测试。

### 4. 设置定时任务

#### Linux/macOS (使用 cron)

1. 编辑 crontab：
```bash
crontab -e
```

2. 添加以下行（每天早上9点检查并发送提醒）：
```bash
0 9 * * * cd /mnt/d/python/item/new/backend && python3 check_reminders.py >> /mnt/d/python/item/new/backend/reminders.log 2>&1
```

3. 保存并退出

#### Windows (使用任务计划程序)

1. 打开"任务计划程序"
2. 创建基本任务
3. 设置触发器：每天早上9点
4. 设置操作：运行程序
   - 程序：`python3`
   - 参数：`check_reminders.py`
   - 起始于：`/mnt/d/python/item/new/backend`

#### 手动运行

也可以手动运行检查脚本：

```bash
cd backend
python3 check_reminders.py
```

## 工作原理

1. **数据库字段**：`capsules` 表中的 `email_sent` 字段记录是否已发送提醒邮件（0=未发送，1=已发送）
2. **检查逻辑**：`check_reminders.py` 脚本会检查所有未开启且未发送提醒的胶囊，如果开启日期在未来7天内或今天，则发送邮件
3. **邮件内容**：邮件使用HTML格式，包含胶囊信息和开启日期
4. **邮件发送**：使用QQ邮箱的SMTP服务发送邮件

## 注意事项

1. **安全性**：不要将授权码提交到版本控制系统，请使用环境变量或配置文件
2. **频率限制**：QQ邮箱有发送频率限制，不要过于频繁地发送邮件
3. **网络连接**：确保服务器有稳定的网络连接
4. **日志查看**：可以通过 `reminders.log` 文件查看邮件发送日志

## 故障排除

### 邮件发送失败

1. 检查授权码是否正确
2. 检查网络连接
3. 检查QQ邮箱是否开启了SMTP服务
4. 查看错误日志

### 定时任务未执行

1. 检查cron服务是否运行：`service cron status`
2. 检查crontab是否正确配置：`crontab -l`
3. 检查Python脚本路径是否正确
4. 查看系统日志：`tail -f /var/log/syslog`

## 功能特点

- ✅ 自动检查即将开启的胶囊
- ✅ 美观的HTML邮件模板
- ✅ 支持QQ邮箱
- ✅ 记录邮件发送状态，避免重复发送
- ✅ 详细的日志记录
- ✅ 每天检查一次，提前7天提醒